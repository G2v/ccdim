<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width">
<title>CCDim</title>
<meta name="viewport" content="width=device-width">
<meta name="description" content="Formulaire de calcul pour le dimensionnement des câbles en très basse tension et en courant continu">
<style>
body {
	background:#bbb;
	font:400 100%/1.2 sans-serif;
}
table {
	margin:auto;
	background:#fff;
	padding:5px 10px;
	border-radius:10px;
	border:1px solid #999;
	box-shadow:0 0 8px rgba(0,0,0,.2);
}
input, select {
	padding:2px;
	width:3.5em;
	height:1.2em;
	background:#f5f5f5;
	border:1px solid #aaa;
	box-sizing:content-box;
	font:400 1.2rem sans-serif;
}
input:focus, select:focus {
	background:#fff;
}
input {
	text-indent:.2em;
}
input:read-only {
	border:none;
	background:#fff;
	-moz-appearance:textfield;
}
input:invalid {
	box-shadow:none;
}
input.highlight, select.highlight{
	background:yellow;
}
caption {
	margin:3vw 0 1rem;
	font-size:1.4rem;
	text-align:center;
}
th {
	font-weight:400;
	text-align:left;
	padding-right:1rem;
}
td {
	white-space: nowrap;
}
td span {
	font-size:1.2rem;
}
tr {
	height:2.5rem;
}
details {
	display:inline-block;
}
</style>
</head>
<body>
<form id="data" oninput="clearHighlights()">
<table>
	<caption>Dimensionnement des câbles en très basse tension et en courant continu</caption>
	<tbody>
		<tr>
				<th><label for="voltage">Tension d'alimentation</label></th>
				<td><input onchange="compute(this)" id="voltage" aria-live="polite" type="number" min="5" step=".1" value="12"> Volts</td>
		</tr>
		<tr>
				<th><label for="power">Puissance absorbée</label></th>
				<td><input onchange="compute(this)" id="power" aria-live="polite" type="number" min="1" step="1" value="180"> Watts</td>
		</tr>
		<tr>
				<th><label for="current">Intensité consommée</label></th>
				<td><input onchange="compute(this)" id="current" aria-live="polite" type="number" min=".1" step=".1" value="15"> Ampères</td>
		</tr>
		<tr>
				<th><label for="length">Longueur de fil&nbsp;aller&nbsp;retour</label></th>
				<td><input onchange="compute(this)" id="length" aria-live="polite" type="number" min=".1" step=".1" value="6"> Mètres</td>
		</tr>
		<tr>
				<th><label for="section">Section de fil théorique</label></th>
				<td><input id="section" type="number" aria-live="polite" readonly value="4"> mm²</td>
		</tr>
		<tr>
				<th><label for="standard_section">Section de fil standard</label></th>
				<td>
					<select onchange="compute(this)" id="standard_section" aria-live="polite">
						<option value="0.25">0,25</option>
						<option value="0.5">0,5</option>
						<option value="0.75">0,75</option>
						<option value="1">1</option>
						<option value="1.5">1,5</option>
						<option value="2">2</option>
						<option value="2.5">2,5</option>
						<option value="4" selected>4</option>
						<option value="6">6</option>
						<option value="10">10</option>
						<option value="16">16</option>
						<option value="25">25</option>
						<option value="35">35</option>
						<option value="50">50</option>
						<option value="51" disabled>> 50</option>
					</select> mm²
				</td>
		</tr>
		<tr>
				<th><label for="voltage_drop_abs">Chute de tension</label></th>
				<td><input onchange="compute(this)" id="voltage_drop_abs" aria-live="polite" type="number" min=".1" step=".1" value="0.5"> Volts</td>
		</tr>
		<tr>
				<th><label for="voltage_drop_per">Chute de tension</label></th>
				<td><input onchange="compute(this)" id="voltage_drop_per" aria-live="polite" type="number" min=".1" step=".1" value="4.3"> %</td>
		</tr>
		<tr>
				<th><label for="power_lost">Puissance perdue</label></th>
				<td><input onchange="compute(this)" id="power_lost" aria-live="polite" type="number" min="1" step="1" value="8"> Watts</td>
		</tr>
	</tbody>
</table>
<script>
function setCurrent(input) {
	current = power / voltage;
	setInput(current, data.current, 1);
}

function setPower(input){ 
	power = current * voltage;
	setInput(power, data.power, 0);
}

function setSection(input) {
	if (input == 'standard_section') {
		section = standard_section;
	}
	else {
		section = (length * current * rho_copper) / voltage_drop_abs;
		for (standard_section of sections) {
			if (section <= standard_section) break;
		}
		setInput(standard_section, data.standard_section, 2);
	}
	setInput(section, data.section, 1);
}

function setVoltageDropAbs(input) {
	if (input == 'voltage_drop_per') {
		voltage_drop_abs = voltage_drop_per * voltage / 100;
	}
	else if (input == 'power_lost') {
		voltage_drop_abs = power_lost / current;
	}
	else {
		voltage_drop_abs = (length * current * rho_copper) / section;
	}
	setInput(voltage_drop_abs, data.voltage_drop_abs, 1);
}

function setVoltageDropPer(input) {
	voltage_drop_per = voltage_drop_abs / voltage * 100;;
	setInput(voltage_drop_per, data.voltage_drop_per, 1);
}

function setLostPower(input) {
	power_lost = voltage_drop_abs * current;
	setInput(power_lost, data.power_lost, 0);
}

function setInput(value, input, decimal) {
	let factor = 10 ** decimal;
	value = Math.round(value * factor) / factor;
	if (input.value != value) {
		input.value = value;
		highlight_values.push(input);
	}
}

function clearHighlights() {
	if (highlight_values) {
		highlight_values.forEach(function(input) {
			input.classList.remove('highlight');
		});
		highlight_values = [];
	}
}

function compute(input) {
	clearHighlights();
	let value = parseFloat(input.value);
	if (isNaN(value)) {
		input.value = window[input.id];
	}
	else {
		let min_value = input.getAttribute('min');
		if (value < min_value) {
			input.value = min_value;
		}
		window[input.id] = input.value
		set_values[input.id].forEach(function(setValue) {
			setValue(input.id);
		});
		highlight_values.forEach(function(input) {
			input.classList.add('highlight');
		});
	}
}

const
data = document.getElementById('data'),
set_values = {
	voltage:          [setCurrent, setVoltageDropAbs, setVoltageDropPer, setLostPower],
	power:            [setCurrent, setVoltageDropAbs, setVoltageDropPer, setLostPower],
	current:          [setPower, setVoltageDropAbs, setVoltageDropPer, setLostPower],
	length:           [setVoltageDropAbs, setVoltageDropPer, setLostPower],
	standard_section: [setSection, setVoltageDropAbs, setVoltageDropPer, setLostPower],
	voltage_drop_abs: [setVoltageDropPer, setLostPower, setSection],
	voltage_drop_per: [setVoltageDropAbs, setLostPower, setSection],
	power_lost:       [setVoltageDropAbs, setVoltageDropPer, setSection]
},
nb_cables = 1,
rho_copper = 0.023,
sections = [0.25, 0.5, 0.75, 1, 1.5, 2, 2.5, 4, 6, 10, 16, 25, 35, 50, 51];

var
highlight_values = [],
voltage          = data.voltage.value,
power            = data.power.value, 
current          = data.current.value, 
length           = data.length.value, 
section          = data.section.value,
standard_section = data.standard_section.value,
voltage_drop_per = data.voltage_drop_per.value,
voltage_drop_abs = data.voltage_drop_abs.value,
power_lost       = data.power_lost.value;
</script>
</body>
</html>
